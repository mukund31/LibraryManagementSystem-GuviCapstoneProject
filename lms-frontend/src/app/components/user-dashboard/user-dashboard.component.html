<div class="container mx-auto px-4 py-8 w-2/3">
  <button [routerLink]="['/books']" class="flex text-blue-600 hover:text-blue-800 hover:underline text-sm">
    <svg class="mt-1" fill="#0000dd" height="12px" width="12px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
    viewBox="0 0 404.258 404.258" xml:space="preserve">
    <polygon points="289.927,18 265.927,0 114.331,202.129 265.927,404.258 289.927,386.258 151.831,202.129 "/>
  </svg>
  View Books Catalog
</button>

  <div class="mt-6">
    <h1 class="text-2xl font-semibold mb-6 text-center">Frequent Borrower Statistics</h1>
    <p class="mt-2 text-lg">Total Books Borrowed: {{ totalBooksBorrowed }}</p>
    <p class="mt-2 text-lg">Overdue Books: {{ overdueBooksCount }}</p>
  </div>

  <h1 class="text-2xl font-semibold mb-6 text-center">Your Borrowing History</h1>

  <div *ngIf="loading" class="text-center text-lg">Loading...</div>

  <div *ngIf="!loading && borrowedBooks.length === 0" class="text-center text-lg text-gray-500">
    No borrowing history found.
  </div>

  <div *ngIf="!loading && borrowedBooks.length > 0">
    <table class="min-w-full bg-white shadow-md rounded-lg">
      <thead>
        <tr class="border-b">
          <th class="px-4 py-2 text-left text-sm font-medium">#</th>
          <th class="px-4 py-2 text-left text-sm font-medium">Book Title</th>
          <th class="px-4 py-2 text-left text-sm font-medium">Borrowed Date</th>
          <th class="px-4 py-2 text-left text-sm font-medium">Due Date</th>
          <th class="px-4 py-2 text-left text-sm font-medium">Days Overdue</th>
          <th class="px-4 py-2 text-left text-sm font-medium">Penalty</th>
          <th class="px-4 py-2 text-left text-sm font-medium">Return</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let book of borrowedBooks; let i = index" class="border-b">
          <td class="px-4 py-2 border-b">{{ i + 1 }}</td>
          <td class="px-4 py-2 text-sm">{{ book.title }}</td>
          <td class="px-4 py-2 text-sm">{{ book.title }}</td>
          <td class="px-4 py-2 text-sm">{{ book.borrowDate | date }}</td>
          <td class="px-4 py-2 text-sm">{{ book.dueDate | date }}</td>
          <td class="px-4 py-2 text-sm">
            <ng-container *ngIf="book.status === 'borrowed'; else returnedText">
              {{ getDaysOverdue(book.dueDate) }}
            </ng-container>
            <ng-template #returnedText>
              <span class="text-green-600 font-semibold">Returned</span>
            </ng-template>
          </td>
          <td class="px-4 py-2 text-sm">{{ calculatePenalty(book.dueDate) }}</td>
          <td class="px-4 py-2 text-sm">
            <ng-container *ngIf="book.status === 'borrowed' && calculatePenalty(book.dueDate)==0;">
              <button class="bg-blue-600 px-3 py-1 rounded-md text-white hover:bg-blue-800" 
                      (click)="returnBook(book)">
                Return
              </button>
            </ng-container>
            <ng-container *ngIf="book.status === 'borrowed' && calculatePenalty(book.dueDate)>0;">
              <button class="bg-blue-600 px-3 py-1 rounded-md text-white hover:bg-blue-800" 
              (click)="payAndReturnBook(book)">
                Pay Penalty and Return
              </button>
            </ng-container>
            <ng-container *ngIf="book.status !== 'borrowed'">
              <span class="text-green-600 font-semibold">Returned</span>
            </ng-container>
          </td>

          <div *ngIf="showPenaltyModal" class="fixed inset-0 bg-black bg-opacity-5 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-sm p-6 w-96">
              <h2 class="text-xl font-semibold mb-4">Pay Penalty</h2>
              <form (ngSubmit)="submitPenalty()">
                <div class="mb-4">
                  <label for="reason" class="block text-sm font-medium mb-1">Reason for delay</label>
                  <textarea
                    id="reason"
                    [(ngModel)]="penaltyReason"
                    name="reason"
                    class="w-full border border-gray-300 rounded-md p-2 focus:ring focus:ring-blue-200"
                    placeholder="Enter reason for delay"
                    rows="3"
                    required
                  ></textarea>
                </div>
                <div class="mb-4">
                  <label for="amount" class="block text-sm font-medium mb-1">Penalty Amount: {{penaltyAmount}}</label>
                </div>
                <div class="flex justify-end">
                  <button
                    type="button"
                    class="bg-gray-300 px-4 py-2 rounded-md text-gray-700 hover:bg-gray-400 mr-2"
                    (click)="closePenaltyModal()"
                  >
                    Cancel
                  </button>
                  <button
                    type="submit"
                    class="bg-blue-600 px-4 py-2 rounded-md text-white hover:bg-blue-800"
                  >
                    Pay
                  </button>
                </div>
              </form>
            </div>
          </div>
        </tr>
      </tbody>
    </table>

  </div>
</div>